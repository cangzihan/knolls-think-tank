
# 操作自动化

## Python模拟鼠标和键盘输入
### 模拟鼠标
```shell
#pip install setuptools==75.1.0
pip install pyautogui -i https://pypi.tuna.tsinghua.edu.cn/simple
```

```python
import pyautogui

# 获取屏幕大小
screen_width, screen_height = pyautogui.size()

# 将鼠标移动到屏幕中央
pyautogui.moveTo(screen_width/2, screen_height/2)

# 单击鼠标左键
pyautogui.click()
```

除了移动和点击操作，`pyautogui`库还提供了其他一些函数，例如`dragTo()`可以实现鼠标拖拽操作，`scroll()`可以实现鼠标滚轮操作等。

### 模拟键盘

```python
import pyautogui

pyautogui.typewrite('ZSSB')  # 输入字符串
pyautogui.typewrite('\nZS is a SB!', interval=0.25)  # 每次输入间隔0.25秒，输入Hello world!
```

#### keyboard库（不好用）
```shell
pip install keyboard
```

```python
import keyboard

# 按下键盘上的某个按键
keyboard.press('a')

# 松开键盘上的某个按键
keyboard.release('a')

# 同时按下多个按键
keyboard.press('ctrl')
keyboard.press('c')
keyboard.release('c')
keyboard.release('ctrl')

```

### 截图
```shell
sudo nala install gnome-screenshot
```

```python
import pyautogui

img = pyautogui.screenshot(r'screenshot.png')  # 截全屏并设置保存图片的位置和名称

```

## selenium
教程
- [selenium库的基本使用 - 简书](https://www.jianshu.com/p/3aa45532e179)
- [selenium之 定位以及切换frame（iframe）_Python_灰蓝-CSDN博客](https://blog.csdn.net/huilan_same/article/details/52200586)
- [Python+Selenium练习篇10-text-获取元素文本_Python_sonnyuu的博客-CSDN博客](https://blog.csdn.net/sonnyuu/article/details/92651566)
- [Selenium入门16 获取页面源代码 - dinghanhua - 博客园](https://www.cnblogs.com/dinghanhua/p/9778562.html)
- [Selenium模拟网页下翻操作 - 简书](https://www.jianshu.com/p/03b349dd8ad6)

### 打开第1个页面
```python
from selenium import webdriver

#browser = webdriver.Firefox()
browser = webdriver.Chrome()

url = "http://www.hao123.com/"
browser.get(url)

```

### demo
一个获取资源id的demo
```python
def get_user_id(music_id):
    print("获取音乐id:", music_id, "的用户")
    url = "https://xxx/#/song?id=" + str(music_id)
    browser = webdriver.Firefox()
    browser.get(url)
    browser.switch_to.frame("g_iframe")  # 定位到g_iframe
    html_code = browser.page_source
    # print(html_code)
    #with open("data.txt", "w+", encoding='utf-8') as f:
    #    f.write(str(html_code))  # 写入

    reg = r'user/home\?id=\d+'  # 正则表达式
    reg_html = re.compile(reg)  # 编译一下，运行更快
    html_list = reg_html.findall(html_code)  # 进行匹配
    id_list = [id[13:] for id in html_list]
    id_list = list(set(id_list))

    browser.quit()  # 关闭浏览器
    print("获取完毕")
    return id_list
```


一个获取用户id的demo
```python
def get_user_list(id):
    browser = webdriver.Firefox()
    url = "https://xxx/#/user/songs/rank?id=" + str(id)
    browser.get(url)
    time.sleep(1)
    browser.switch_to.frame("g_iframe") #定位到g_iframe
    li = browser.find_element_by_xpath("//ul")
    li_text = li.text
    li_list = li_text.split('\n')
    if "分享" in li_list:
        li_list.remove("分享")
    if "下载" in li_list:
        li_list.remove("下载")
    #print(li_list)

    music_list = [li_list[i] for i in range(1,len(li_list),2)]
    #print(music_list)
    browser.quit()	#关闭浏览器

    music_dict = {}
    music_dict["id"] = id
    music_dict["record"] = music_list

    return music_dict

```
